<!-- 
* KINOVA (R) KORTEX (TM)
*
* Copyright (c) 2018 Kinova inc. All rights reserved.
*
* This software may be modified and distributed 
* under the terms of the BSD 3-Clause license.
*
* Refer to the LICENSE file for details.
*
* -->

# Kortex Device Manager

## Overview
This package implements a ROS node that allows basic communication with every device supported by the Kortex framework. Use this package if you want to:

* List all the devices available on a specific Gen3 robot.
* Retrieve generic information of a given device.
* Get the firmware version of a given device.
* Get the serial number of a given device.
* Set the IPv4 settings of a given device.
* Get the safety information of a given device.

### License

The source code is released under a [BSD 3-Clause license](../LICENSE).

**Author: Kinova inc.<br />
Affiliation: [Kinova inc.](https://www.kinovarobotics.com/)<br />
Maintainer: Kinova inc. support@kinovarobotics.com**

This package has been tested under ROS Kinetic and Ubuntu 16.04.

## Installation

### Building from Source

#### Dependencies

- [Robot Operating System (ROS)](http://wiki.ros.org) robotics middleware
- [protobuf](https://developers.google.com/protocol-buffers/)

```cpp
git clone https://github.com/protocolbuffers/protobuf --branch 3.5.1.1   (you must use this specific version)
```
Follow these [instructions](https://github.com/protocolbuffers/protobuf/blob/master/src/README.md) to build and install protobuf and its compiler.

#### Building

To build from source, clone the latest version from this repository into your catkin workspace and compile the package using

        cd catkin_workspace/src
        git clone https://github.com/Kinovarobotics/ros_kortex.git
        cd ../
        sudo ./src/ros_kortex/build.sh

## Usage

### Launch file
The launch file for this node can be found in the [kortex_bringup](../kortex_bringup/readme.md) package.

### Starting with rosrun

<code>rosrun kortex\_device\_manager kortex\_device\_manager 192.168.1.10</code>

The command above would run the kortex\_device\_manager node on a Gen3 robot with IP address 192.168.1.10.

## Nodes

### Published Topics

* **`/KortexError`**
    <p>Every Kortex error will be published here. </p>
    
    | Type | Name | Description |
    |:---:|:---:|:---:|
    | uint32 | code | Error code, see enum in the ErrorCodes class. |
    | uint32 | subcode | Sub error code, see enum in the ErrorCodes class. |
    | string | description | Details of the error. |

### Services
Most of the services supported by this node are generated from the [C++ Kortex API](https://github.com/Kinovarobotics/kortex). You can find the documentation [here](https://github.com/Kinovarobotics/kortex/blob/master/api_cpp/doc/markdown/index.md).

Example:
If you want to call the ROS service **`GetActuatorCount`** generated by the C++ method [GetActuatorCount](https://github.com/Kinovarobotics/kortex/blob/master/api_cpp/doc/markdown/references/summary_DeviceManager.md), you would initialize your service as follows:

    ros::ServiceClient client_ClearSafetyStatus = n.serviceClient<kortex_driver::ClearSafetyStatus>("ClearSafetyStatus");

### Messages
Most of the messages supported by this node are generated from the [ C++ Kortex API](https://github.com/Kinovarobotics/kortex). You can find the documentation [here](https://github.com/Kinovarobotics/kortex/blob/master/api_cpp/doc/markdown/index.md).

#### Non-generated

* **`KortexError`**
    <p>Represents a Kortex API error.</p>

### Protos files
The folder **protos** contains the protobuf files from where the MSG, SRV and source files are generated. The content of this folder should not be modified.

### Template files
The folder **templates** contains all the JINJA2 files needed by the protoc generator. For more details on the generation process, see the **generation** section.

| Filename | Description |
|:---:|:---:|
| main.jinja2 | Used to generate src/main.cpp |
| NodeServices.cpp.jinja2 | Used to generate src/node.cpp |
| NodeServices.h.jinja2 | Used to generate src/node.h |
| proto_converterCPP.jinja2 | Used to generate every src/*_proto\_converter.cpp file |
| proto_converterHeader.jinja2 | Used to generate every src/*_proto\_converter.h file |
| ros_converterCPP.jinja2 | Used to generate every src/*_ros\_converter.cpp file |
| ros_converterHeader.jinja2 | Used to generate every src/*_proto\_converter.h file |
| ros_enum.jinja2 | Use to generated every msg/*.msg file that represents a protobuf enum |
| ros_message.jinja2 | Used to generate every msg/*.msg file that represents a protobuf message |
| ros_oneof.jinja2 | Used to generate every msg/*.msg file that represents a protobuf oneof |
| ros_service.jinja2 | Used to generate every msg/*.msg file that represents a protobuf RPC |

## Generation
<p>
The generation process is based on a custom protobuf plugin. Most of the generation process is in the RosGeneration.py file located in the package root directory.
</p>

To launch the generation of this package:

1. Open a terminal window.
1. Browse to the root directory of this package [YOUR\_ROS\_WORKSPACE]/src/ros\_kortex/kortex\_device\_manager/
1. Ensure that the file kortex_driver.sh can be executed. If not then <code>chmod +x kortex_device_manager.sh</code>
1. Run this command: <code>protoc --plugin=protoc-gen-custom=kortex_device_manager.sh -I./protos/ --custom_out=./build ./protos/\*.prot</code>
1. The result of the generation will be in the following directories:
    * /src
    * /msg
    * /srv

